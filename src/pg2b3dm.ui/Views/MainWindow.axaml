<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:pg2b3dm.ui.ViewModels"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d" d:DesignWidth="900" d:DesignHeight="700"
        x:Class="pg2b3dm.ui.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Icon="/Assets/avalonia-logo.ico"
        Title="pg2b3dm - PostGIS to 3D Tiles Converter"
        Width="900" Height="700">

    <Design.DataContext>
        <vm:MainWindowViewModel/>
    </Design.DataContext>

    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Configuration Panel -->
        <ScrollViewer Grid.Row="0" MaxHeight="400">
            <StackPanel Spacing="10">
                <!-- Database Connection -->
                <Border BorderBrush="Gray" BorderThickness="1" CornerRadius="5" Padding="10">
                    <StackPanel Spacing="8">
                        <TextBlock Text="Database Connection" FontWeight="Bold" FontSize="14"/>
                        
                        <Grid ColumnDefinitions="120,*">
                            <TextBlock Text="Host:" VerticalAlignment="Center"/>
                            <TextBox Grid.Column="1" Text="{Binding Host}" Watermark="localhost"/>
                        </Grid>

                        <Grid ColumnDefinitions="120,*">
                            <TextBlock Text="Port:" VerticalAlignment="Center"/>
                            <TextBox Grid.Column="1" Text="{Binding Port}" Watermark="5432"/>
                        </Grid>

                        <Grid ColumnDefinitions="120,*">
                            <TextBlock Text="Database:" VerticalAlignment="Center"/>
                            <TextBox Grid.Column="1" Text="{Binding Database}" Watermark="Database name"/>
                        </Grid>

                        <Grid ColumnDefinitions="120,*">
                            <TextBlock Text="Username:" VerticalAlignment="Center"/>
                            <TextBox Grid.Column="1" Text="{Binding Username}" Watermark="Username"/>
                        </Grid>

                        <Grid ColumnDefinitions="120,*">
                            <TextBlock Text="Password:" VerticalAlignment="Center"/>
                            <TextBox Grid.Column="1" Text="{Binding Password}" 
                                     PasswordChar="â—" 
                                     Watermark="Password (leave empty for trusted connection)"/>
                        </Grid>
                    </StackPanel>
                </Border>

                <!-- Geometry Settings -->
                <Border BorderBrush="Gray" BorderThickness="1" CornerRadius="5" Padding="10">
                    <StackPanel Spacing="8">
                        <TextBlock Text="Geometry Settings" FontWeight="Bold" FontSize="14"/>
                        
                        <Grid ColumnDefinitions="120,*">
                            <TextBlock Text="Table:*" VerticalAlignment="Center" Foreground="Red"/>
                            <TextBox Grid.Column="1" Text="{Binding GeometryTable}" Watermark="Schema.table (required)"/>
                        </Grid>

                        <Grid ColumnDefinitions="120,*">
                            <TextBlock Text="Geometry Column:" VerticalAlignment="Center"/>
                            <TextBox Grid.Column="1" Text="{Binding GeometryColumn}" Watermark="geom"/>
                        </Grid>

                        <Grid ColumnDefinitions="120,*">
                            <TextBlock Text="Attributes:" VerticalAlignment="Center"/>
                            <TextBox Grid.Column="1" Text="{Binding AttributeColumns}" Watermark="col1,col2,col3"/>
                        </Grid>

                        <Grid ColumnDefinitions="120,*">
                            <TextBlock Text="Query:" VerticalAlignment="Center"/>
                            <TextBox Grid.Column="1" Text="{Binding Query}" Watermark="WHERE clause"/>
                        </Grid>

                        <Grid ColumnDefinitions="120,*">
                            <TextBlock Text="Output Path:" VerticalAlignment="Center"/>
                            <TextBox Grid.Column="1" Text="{Binding Output}" Watermark="output"/>
                        </Grid>
                    </StackPanel>
                </Border>

                <!-- Advanced Options -->
                <Expander Header="Advanced Options" IsExpanded="False">
                    <Border BorderBrush="Gray" BorderThickness="1" CornerRadius="5" Padding="10" Margin="0,5,0,0">
                        <StackPanel Spacing="8">
                            <Grid ColumnDefinitions="*,*" ColumnSpacing="10">
                                <StackPanel Grid.Column="0" Spacing="8">
                                    <Grid ColumnDefinitions="120,*">
                                        <TextBlock Text="Radius Column:" VerticalAlignment="Center"/>
                                        <TextBox Grid.Column="1" Text="{Binding RadiusColumn}"/>
                                    </Grid>

                                    <Grid ColumnDefinitions="120,*">
                                        <TextBlock Text="Shaders Column:" VerticalAlignment="Center"/>
                                        <TextBox Grid.Column="1" Text="{Binding ShadersColumn}"/>
                                    </Grid>

                                    <Grid ColumnDefinitions="120,*">
                                        <TextBlock Text="LOD Column:" VerticalAlignment="Center"/>
                                        <TextBox Grid.Column="1" Text="{Binding LodColumn}"/>
                                    </Grid>

                                    <Grid ColumnDefinitions="120,*">
                                        <TextBlock Text="Default Color:" VerticalAlignment="Center"/>
                                        <TextBox Grid.Column="1" Text="{Binding DefaultColor}"/>
                                    </Grid>

                                    <Grid ColumnDefinitions="120,*">
                                        <TextBlock Text="Metallic/Rough:" VerticalAlignment="Center"/>
                                        <TextBox Grid.Column="1" Text="{Binding DefaultMetallicRoughness}"/>
                                    </Grid>

                                    <Grid ColumnDefinitions="120,*">
                                        <TextBlock Text="Alpha Mode:" VerticalAlignment="Center"/>
                                        <ComboBox Grid.Column="1" ItemsSource="{Binding AlphaModes}" 
                                                  SelectedItem="{Binding DefaultAlphaMode}"/>
                                    </Grid>

                                    <Grid ColumnDefinitions="120,*">
                                        <TextBlock Text="Copyright:" VerticalAlignment="Center"/>
                                        <TextBox Grid.Column="1" Text="{Binding Copyright}"/>
                                    </Grid>
                                </StackPanel>

                                <StackPanel Grid.Column="1" Spacing="8">
                                    <Grid ColumnDefinitions="150,*">
                                        <TextBlock Text="Tileset Version:" VerticalAlignment="Center"/>
                                        <TextBox Grid.Column="1" Text="{Binding TilesetVersion}"/>
                                    </Grid>

                                    <Grid ColumnDefinitions="150,*">
                                        <TextBlock Text="Max Features/Tile:" VerticalAlignment="Center"/>
                                        <NumericUpDown Grid.Column="1" Value="{Binding MaxFeaturesPerTile}" 
                                                       Minimum="1" Maximum="10000" Increment="100"/>
                                    </Grid>

                                    <Grid ColumnDefinitions="150,*">
                                        <TextBlock Text="Geometric Error:" VerticalAlignment="Center"/>
                                        <NumericUpDown Grid.Column="1" Value="{Binding GeometricError}" 
                                                       Minimum="0" Maximum="10000" Increment="100"/>
                                    </Grid>

                                    <Grid ColumnDefinitions="150,*">
                                        <TextBlock Text="Geometric Error Factor:" VerticalAlignment="Center"/>
                                        <NumericUpDown Grid.Column="1" Value="{Binding GeometricErrorFactor}" 
                                                       Minimum="1" Maximum="10" Increment="0.5"/>
                                    </Grid>

                                    <Grid ColumnDefinitions="150,*">
                                        <TextBlock Text="Refinement:" VerticalAlignment="Center"/>
                                        <ComboBox Grid.Column="1" ItemsSource="{Binding RefinementTypes}" 
                                                  SelectedItem="{Binding Refinement}"/>
                                    </Grid>

                                    <Grid ColumnDefinitions="150,*">
                                        <TextBlock Text="Subdivision:" VerticalAlignment="Center"/>
                                        <ComboBox Grid.Column="1" ItemsSource="{Binding SubdivisionSchemes}" 
                                                  SelectedItem="{Binding Subdivision}"/>
                                    </Grid>
                                </StackPanel>
                            </Grid>

                            <StackPanel Spacing="5" Margin="0,10,0,0">
                                <CheckBox IsChecked="{Binding DoubleSided}" Content="Double Sided"/>
                                <CheckBox IsChecked="{Binding CreateGltf}" Content="Create glTF"/>
                                <CheckBox IsChecked="{Binding UseImplicitTiling}" Content="Use Implicit Tiling"/>
                                <CheckBox IsChecked="{Binding AddOutlines}" Content="Add Outlines"/>
                                <CheckBox IsChecked="{Binding SkipCreateTiles}" Content="Skip Create Tiles"/>
                                <CheckBox IsChecked="{Binding KeepProjection}" Content="Keep Projection"/>
                            </StackPanel>
                        </StackPanel>
                    </Border>
                </Expander>

                <!-- Run Button -->
                <Button Command="{Binding RunPg2B3dmCommand}" 
                        IsEnabled="{Binding !IsRunning}"
                        HorizontalAlignment="Stretch"
                        Height="40"
                        FontSize="14"
                        FontWeight="Bold">
                    <TextBlock Text="{Binding IsRunning, Converter={StaticResource BoolToRunTextConverter}}"/>
                </Button>
            </StackPanel>
        </ScrollViewer>

        <!-- Output Log -->
        <Border Grid.Row="1" BorderBrush="Gray" BorderThickness="1" CornerRadius="5" Padding="10" Margin="0,10,0,0">
            <Grid RowDefinitions="Auto,*">
                <TextBlock Text="Output Log" FontWeight="Bold" FontSize="14" Margin="0,0,0,5"/>
                <ScrollViewer Grid.Row="1">
                    <TextBox Text="{Binding OutputLog}" 
                             IsReadOnly="True" 
                             TextWrapping="Wrap"
                             FontFamily="Consolas,Courier New,monospace"
                             Background="#1E1E1E"
                             Foreground="#D4D4D4"
                             AcceptsReturn="True"/>
                </ScrollViewer>
            </Grid>
        </Border>
    </Grid>
</Window>
