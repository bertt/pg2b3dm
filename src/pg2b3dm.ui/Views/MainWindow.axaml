<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:pg2b3dm.ui.ViewModels"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d" d:DesignWidth="900" d:DesignHeight="700"
        x:Class="pg2b3dm.ui.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Icon="/Assets/avalonia-logo.ico"
        Title="pg2b3dm - PostGIS to 3D Tiles Converter"
        Width="900" Height="700"
        Background="#1E1E1E">

    <Design.DataContext>
        <vm:MainWindowViewModel/>
    </Design.DataContext>

    <Window.Styles>
        <!-- Modern Card Style -->
        <Style Selector="Border.card">
            <Setter Property="Background" Value="#252526"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Padding" Value="16"/>
            <Setter Property="BoxShadow" Value="0 4 12 0 #40000000"/>
        </Style>

        <!-- Section Header Style -->
        <Style Selector="TextBlock.section-header">
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Margin" Value="0,0,0,10"/>
        </Style>

        <!-- Primary Button Style -->
        <Style Selector="Button.primary">
            <Setter Property="Background" Value="#0E639C"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="CornerRadius" Value="6"/>
            <Setter Property="Cursor" Value="Hand"/>
        </Style>
        <Style Selector="Button.primary:pointerover /template/ ContentPresenter">
            <Setter Property="Background" Value="#1177BB"/>
        </Style>
        <Style Selector="Button.primary:pressed /template/ ContentPresenter">
            <Setter Property="Background" Value="#094771"/>
        </Style>
        <Style Selector="Button.primary:disabled /template/ ContentPresenter">
            <Setter Property="Background" Value="#3E3E42"/>
        </Style>

        <!-- Success Button Style -->
        <Style Selector="Button.success">
            <Setter Property="Background" Value="#10B981"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="CornerRadius" Value="6"/>
            <Setter Property="Cursor" Value="Hand"/>
        </Style>
        <Style Selector="Button.success:pointerover /template/ ContentPresenter">
            <Setter Property="Background" Value="#34D399"/>
        </Style>
        <Style Selector="Button.success:pressed /template/ ContentPresenter">
            <Setter Property="Background" Value="#059669"/>
        </Style>

        <!-- Warning Button Style -->
        <Style Selector="Button.warning">
            <Setter Property="Background" Value="#F59E0B"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="CornerRadius" Value="6"/>
            <Setter Property="Cursor" Value="Hand"/>
        </Style>

        <!-- Colored TextBox Style -->
        <Style Selector="TextBox">
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="#3E3E42"/>
            <Setter Property="CornerRadius" Value="4"/>
            <Setter Property="Padding" Value="8,6"/>
            <Setter Property="Background" Value="#2D2D30"/>
            <Setter Property="Foreground" Value="#CCCCCC"/>
        </Style>
        <Style Selector="TextBox:focus">
            <Setter Property="BorderBrush" Value="#0078D4"/>
            <Setter Property="BorderThickness" Value="2"/>
        </Style>
        <Style Selector="TextBox:pointerover">
            <Setter Property="Background" Value="#333337"/>
        </Style>

        <!-- NumericUpDown Style -->
        <Style Selector="NumericUpDown">
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="#3E3E42"/>
            <Setter Property="CornerRadius" Value="4"/>
            <Setter Property="Background" Value="#2D2D30"/>
            <Setter Property="Foreground" Value="#CCCCCC"/>
        </Style>

        <!-- ComboBox Style -->
        <Style Selector="ComboBox">
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="#3E3E42"/>
            <Setter Property="CornerRadius" Value="4"/>
            <Setter Property="Background" Value="#2D2D30"/>
            <Setter Property="Foreground" Value="#CCCCCC"/>
        </Style>

        <!-- CheckBox Style -->
        <Style Selector="CheckBox">
            <Setter Property="Foreground" Value="#CCCCCC"/>
        </Style>

        <!-- Colored Label Style -->
        <Style Selector="TextBlock.label">
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="Foreground" Value="#9CDCFE"/>
            <Setter Property="FontSize" Value="12"/>
        </Style>

        <!-- Accent Header Styles -->
        <Style Selector="Border.header-blue">
            <Setter Property="Background" Value="#0E639C"/>
            <Setter Property="CornerRadius" Value="6,6,0,0"/>
            <Setter Property="Padding" Value="12,8"/>
        </Style>
        <Style Selector="Border.header-green">
            <Setter Property="Background" Value="#10B981"/>
            <Setter Property="CornerRadius" Value="6,6,0,0"/>
            <Setter Property="Padding" Value="12,8"/>
        </Style>
        <Style Selector="Border.header-purple">
            <Setter Property="Background" Value="#8B5CF6"/>
            <Setter Property="CornerRadius" Value="6,6,0,0"/>
            <Setter Property="Padding" Value="12,8"/>
        </Style>
        <Style Selector="Border.header-orange">
            <Setter Property="Background" Value="#F59E0B"/>
            <Setter Property="CornerRadius" Value="6,6,0,0"/>
            <Setter Property="Padding" Value="12,8"/>
        </Style>

        <!-- Log TextBox Style -->
        <Style Selector="TextBox.log">
            <Setter Property="Background" Value="#1E1E1E"/>
            <Setter Property="Foreground" Value="#CCCCCC"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="FontFamily" Value="Consolas,Courier New,monospace"/>
            <Setter Property="FontSize" Value="11"/>
        </Style>

        <!-- Header Text Style -->
        <Style Selector="TextBlock.header-text">
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="FontSize" Value="13"/>
        </Style>
    </Window.Styles>

    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Configuration Panel -->
        <ScrollViewer Grid.Row="0" VerticalScrollBarVisibility="Auto">
            <StackPanel Spacing="12">
                <!-- Database Connection - Compact -->
                <Border Classes="card" CornerRadius="8">
                    <StackPanel Spacing="0">
                        <Border Classes="header-blue" Margin="-16,-16,-16,0">
                            <TextBlock Text="ðŸ—„ï¸ Database Connection" Classes="header-text"/>
                        </Border>
                        
                        <StackPanel Spacing="8" Margin="0,12,0,0">
                            <Grid ColumnDefinitions="*,*,*,*" ColumnSpacing="8" RowDefinitions="Auto,Auto" RowSpacing="6">
                                <StackPanel Grid.Column="0">
                                    <TextBlock Text="Host" Classes="label"/>
                                    <TextBox Text="{Binding Host}" Watermark="localhost"/>
                                </StackPanel>
                                <StackPanel Grid.Column="1">
                                    <TextBlock Text="Port" Classes="label"/>
                                    <TextBox Text="{Binding Port}" Watermark="5432"/>
                                </StackPanel>
                                <StackPanel Grid.Column="2">
                                    <TextBlock Text="Database" Classes="label"/>
                                    <TextBox Text="{Binding Database}" Watermark="postgres"/>
                                </StackPanel>
                                <StackPanel Grid.Column="3">
                                    <TextBlock Text="Username" Classes="label"/>
                                    <TextBox Text="{Binding Username}" Watermark="postgres"/>
                                </StackPanel>
                                <StackPanel Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="4">
                                    <TextBlock Text="Password (optional)" Classes="label"/>
                                    <TextBox Text="{Binding Password}" PasswordChar="â—" Watermark="Leave empty for trusted connection"/>
                                </StackPanel>
                            </Grid>
                        </StackPanel>
                    </StackPanel>
                </Border>

                <!-- Geometry Settings - Compact -->
                <Border Classes="card" CornerRadius="8">
                    <StackPanel Spacing="0">
                        <Border Classes="header-green" Margin="-16,-16,-16,0">
                            <TextBlock Text="ðŸ“ Geometry Settings" Classes="header-text"/>
                        </Border>
                        
                        <StackPanel Spacing="8" Margin="0,12,0,0">
                            <Grid ColumnDefinitions="2*,*,2*" ColumnSpacing="8" RowDefinitions="Auto,Auto,Auto" RowSpacing="6">
                                <StackPanel Grid.Column="0">
                                    <TextBlock Classes="label">
                                        <Run Text="Table"/>
                                        <Run Text="*" Foreground="#F87171" FontWeight="Bold"/>
                                    </TextBlock>
                                    <TextBox Text="{Binding GeometryTable}" Watermark="schema.table (required)"/>
                                </StackPanel>
                                <StackPanel Grid.Column="1">
                                    <TextBlock Text="Geometry Column" Classes="label"/>
                                    <TextBox Text="{Binding GeometryColumn}" Watermark="geom"/>
                                </StackPanel>
                                <StackPanel Grid.Column="2">
                                    <TextBlock Text="Output Path" Classes="label"/>
                                    <TextBox Text="{Binding Output}" Watermark="output"/>
                                </StackPanel>
                                
                                <StackPanel Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="3">
                                    <TextBlock Text="Attributes (comma-separated)" Classes="label"/>
                                    <TextBox Text="{Binding AttributeColumns}" Watermark="col1,col2,col3"/>
                                </StackPanel>
                                
                                <StackPanel Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="3">
                                    <TextBlock Text="Query (WHERE clause)" Classes="label"/>
                                    <TextBox Text="{Binding Query}" Watermark="Optional WHERE clause"/>
                                </StackPanel>
                            </Grid>
                        </StackPanel>
                    </StackPanel>
                </Border>

                <!-- Advanced Options - Expanded by Default -->
                <Border Classes="card" CornerRadius="8">
                    <StackPanel Spacing="0">
                        <Border Classes="header-purple" Margin="-16,-16,-16,0">
                            <TextBlock Text="âš™ï¸ Advanced Options" Classes="header-text"/>
                        </Border>
                        
                        <StackPanel Spacing="8" Margin="0,12,0,0">
                            <Grid ColumnDefinitions="*,*" ColumnSpacing="12">
                                <!-- Left Column -->
                                <StackPanel Grid.Column="0" Spacing="8">
                                    <Grid ColumnDefinitions="Auto,*" ColumnSpacing="8">
                                        <TextBlock Grid.Column="0" Text="Radius Column" Classes="label" Width="120"/>
                                        <TextBox Grid.Column="1" Text="{Binding RadiusColumn}"/>
                                    </Grid>
                                    <Grid ColumnDefinitions="Auto,*" ColumnSpacing="8">
                                        <TextBlock Grid.Column="0" Text="Shaders Column" Classes="label" Width="120"/>
                                        <TextBox Grid.Column="1" Text="{Binding ShadersColumn}"/>
                                    </Grid>
                                    <Grid ColumnDefinitions="Auto,*" ColumnSpacing="8">
                                        <TextBlock Grid.Column="0" Text="LOD Column" Classes="label" Width="120"/>
                                        <TextBox Grid.Column="1" Text="{Binding LodColumn}"/>
                                    </Grid>
                                    <Grid ColumnDefinitions="Auto,*" ColumnSpacing="8">
                                        <TextBlock Grid.Column="0" Text="Default Color" Classes="label" Width="120"/>
                                        <TextBox Grid.Column="1" Text="{Binding DefaultColor}" Watermark="#FFFFFF"/>
                                    </Grid>
                                    <Grid ColumnDefinitions="Auto,*" ColumnSpacing="8">
                                        <TextBlock Grid.Column="0" Text="Metallic/Rough" Classes="label" Width="120"/>
                                        <TextBox Grid.Column="1" Text="{Binding DefaultMetallicRoughness}" Watermark="#008000"/>
                                    </Grid>
                                    <Grid ColumnDefinitions="Auto,*" ColumnSpacing="8">
                                        <TextBlock Grid.Column="0" Text="Alpha Mode" Classes="label" Width="120"/>
                                        <ComboBox Grid.Column="1" ItemsSource="{Binding AlphaModes}" 
                                                  SelectedItem="{Binding DefaultAlphaMode}" HorizontalAlignment="Stretch"/>
                                    </Grid>
                                    <Grid ColumnDefinitions="Auto,*" ColumnSpacing="8">
                                        <TextBlock Grid.Column="0" Text="Copyright" Classes="label" Width="120"/>
                                        <TextBox Grid.Column="1" Text="{Binding Copyright}"/>
                                    </Grid>
                                </StackPanel>

                                <!-- Right Column -->
                                <StackPanel Grid.Column="1" Spacing="8">
                                    <Grid ColumnDefinitions="Auto,*" ColumnSpacing="8">
                                        <TextBlock Grid.Column="0" Text="Tileset Version" Classes="label" Width="120"/>
                                        <TextBox Grid.Column="1" Text="{Binding TilesetVersion}"/>
                                    </Grid>
                                    <Grid ColumnDefinitions="Auto,*" ColumnSpacing="8">
                                        <TextBlock Grid.Column="0" Text="Max Features/Tile" Classes="label" Width="120"/>
                                        <NumericUpDown Grid.Column="1" Value="{Binding MaxFeaturesPerTile}" 
                                                       Minimum="1" Maximum="10000" Increment="100" HorizontalAlignment="Stretch"/>
                                    </Grid>
                                    <Grid ColumnDefinitions="Auto,*" ColumnSpacing="8">
                                        <TextBlock Grid.Column="0" Text="Geometric Error" Classes="label" Width="120"/>
                                        <NumericUpDown Grid.Column="1" Value="{Binding GeometricError}" 
                                                       Minimum="0" Maximum="10000" Increment="100" HorizontalAlignment="Stretch"/>
                                    </Grid>
                                    <Grid ColumnDefinitions="Auto,*" ColumnSpacing="8">
                                        <TextBlock Grid.Column="0" Text="Error Factor" Classes="label" Width="120"/>
                                        <NumericUpDown Grid.Column="1" Value="{Binding GeometricErrorFactor}" 
                                                       Minimum="1" Maximum="10" Increment="0.5" HorizontalAlignment="Stretch"/>
                                    </Grid>
                                    <Grid ColumnDefinitions="Auto,*" ColumnSpacing="8">
                                        <TextBlock Grid.Column="0" Text="Refinement" Classes="label" Width="120"/>
                                        <ComboBox Grid.Column="1" ItemsSource="{Binding RefinementTypes}" 
                                                  SelectedItem="{Binding Refinement}" HorizontalAlignment="Stretch"/>
                                    </Grid>
                                    <Grid ColumnDefinitions="Auto,*" ColumnSpacing="8">
                                        <TextBlock Grid.Column="0" Text="Subdivision" Classes="label" Width="120"/>
                                        <ComboBox Grid.Column="1" ItemsSource="{Binding SubdivisionSchemes}" 
                                                  SelectedItem="{Binding Subdivision}" HorizontalAlignment="Stretch"/>
                                    </Grid>
                                </StackPanel>
                            </Grid>

                            <!-- Checkboxes in a compact grid -->
                            <Border Background="#2D2D30" CornerRadius="4" Padding="12" Margin="0,8,0,0">
                                <Grid ColumnDefinitions="*,*,*" RowDefinitions="Auto,Auto" ColumnSpacing="12" RowSpacing="6">
                                    <CheckBox Grid.Column="0" Grid.Row="0" IsChecked="{Binding DoubleSided}" Content="Double Sided"/>
                                    <CheckBox Grid.Column="1" Grid.Row="0" IsChecked="{Binding CreateGltf}" Content="Create glTF"/>
                                    <CheckBox Grid.Column="2" Grid.Row="0" IsChecked="{Binding UseImplicitTiling}" Content="Implicit Tiling"/>
                                    <CheckBox Grid.Column="0" Grid.Row="1" IsChecked="{Binding AddOutlines}" Content="Add Outlines"/>
                                    <CheckBox Grid.Column="1" Grid.Row="1" IsChecked="{Binding SkipCreateTiles}" Content="Skip Create Tiles"/>
                                    <CheckBox Grid.Column="2" Grid.Row="1" IsChecked="{Binding KeepProjection}" Content="Keep Projection"/>
                                </Grid>
                            </Border>
                        </StackPanel>
                    </StackPanel>
                </Border>

                <!-- Run Button -->
                <Button Command="{Binding RunPg2B3dmCommand}" 
                        IsEnabled="{Binding !IsRunning}"
                        Classes="success"
                        HorizontalAlignment="Stretch"
                        Height="44"
                        FontSize="14"
                        FontWeight="SemiBold">
                    <TextBlock Text="{Binding IsRunning, Converter={StaticResource BoolToRunTextConverter}}"/>
                </Button>
            </StackPanel>
        </ScrollViewer>

        <!-- Output Log - Minimal Height (1 line) -->
        <Border Grid.Row="1" Classes="card" Margin="0,12,0,0" CornerRadius="8">
            <Grid RowDefinitions="Auto,Auto">
                <Border Classes="header-orange" Margin="-16,-16,-16,0">
                    <TextBlock Text="ðŸ“‹ Output Log" Classes="header-text"/>
                </Border>
                <Border Grid.Row="1" Background="#1E1E1E" CornerRadius="0,0,6,6" Padding="8" Margin="0,0,0,0">
                    <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Auto" Height="28">
                        <TextBox Classes="log"
                                 Text="{Binding OutputLog}" 
                                 IsReadOnly="True" 
                                 TextWrapping="Wrap"
                                 AcceptsReturn="True"
                                 BorderThickness="0"/>
                    </ScrollViewer>
                </Border>
            </Grid>
        </Border>
    </Grid>
</Window>
